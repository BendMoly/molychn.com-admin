webpackJsonp([3],{L3d2:function(t,e){},MnuC:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("//Fk"),n=a.n(s),o=a("7+uW").default.prototype.$isServer,l=!o&&document.addEventListener?function(t,e,a){t&&e&&a&&t.addEventListener(e,a,!1)}:function(t,e,a){t&&e&&a&&t.attachEvent("on"+e,a)},i=!o&&document.removeEventListener?function(t,e,a){t&&e&&t.removeEventListener(e,a,!1)}:function(t,e,a){t&&e&&t.detachEvent("on"+e,a)};var c={mounted:function(){this.fetchColumns()},data:function(){return{columns:[],column:"",columnName:"",tags:[],tagOptions:[],title:"",abstract:"",markdown:"",qiniuToken:"",uploadData:null,type:"all",images_source:[{src:"",name:"",type:0}],sourceIdx:-1,reference:null,moveIn:!1}},methods:{checkEditStatus:function(){var t=this,e=this.$route.query.id;e&&"string"==typeof e&&this.$http.get("/articles/"+e).then(function(e){for(var a=0;a<t.columns.length;a++)e.data.columnId===t.columns[a]._id&&(t.column=t.columns[a].title,t.tagOptions=t.columns[a].tags);t.tags=e.data.tags,t.title=e.data.title,t.abstract=e.data.abstract,t.markdown=e.data.content})},fetchColumns:function(){var t=this;this.$http.get("/columns").then(function(e){t.columns=e.data,t.checkEditStatus()})},handleSelect:function(t){var e=this.columns.filter(function(e){return e._id===t});this.tagOptions=e[0].tags,this.columnName=e[0].title},sendArticle:function(){var t=this,e={title:this.title,abstract:this.abstract,columnId:this.column,columnName:this.columnName,tags:this.tags,content:this.markdown};this.$http.post("/articles",e).then(function(e){t.$message({type:"success",message:"发表成功"})})},getQiniuToken:function(t){var e=this;this.$http.get("/upload").then(function(t){e.qiniuToken=t.data,e.uploadData={token:t.data}})},beforeUpload:function(t){var e=this;return new n.a(function(a,s){e.uploadData={token:e.qiniuToken,key:t.name,fname:t.name},e.uploadData.fname?(console.log(e.uploadData),setTimeout(function(){a(!0)},200)):s(new Error("the fname is empty"))})},successUpload:function(){this.$refs.uploadForm.clearFiles()},showSource:function(){this.moveIn=!0,this.getQiniuToken(),l(document,"click",this.handleDocumentClick)},showSourceToggle:function(){this.moveIn=!this.moveIn,this.moveIn?(this.getQiniuToken(),l(document,"click",this.handleDocumentClick)):i(document,"click",this.handleDocumentClick)},sourceSlt:function(t){console.log(t),this.sourceIdx=t},sourceDel:function(t){var e=this;console.log(t),this.$confirm("确定删除该素材?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$message({type:"success",message:"删除成功!"})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},handleDocumentClick:function(t){var e=this.$refs.imgSource;this.$el&&e&&!e.contains(t.target)&&(this.moveIn=!1,console.log(1),i(document,"click",this.handleDocumentClick))}},destroyed:function(){i(document,"click",this.handleDocumentClick)}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"release-container"},[a("div",{staticClass:"release-items"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:2}},[a("label",[t._v("栏目：")])]),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.handleSelect},model:{value:t.column,callback:function(e){t.column=e},expression:"column"}},t._l(t.columns,function(t){return a("el-option",{key:t._id,attrs:{label:t.title,value:t._id}})}))],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("label",[t._v("标签：")])]),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-select",{attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择文章标签"},model:{value:t.tags,callback:function(e){t.tags=e},expression:"tags"}},t._l(t.tagOptions,function(t){return a("el-option",{key:t,attrs:{label:t,value:t}})}))],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("label",[t._v("标题：")])]),t._v(" "),a("el-col",{attrs:{span:22}},[a("el-input",{model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),t._v(" "),a("el-col",{attrs:{span:2}},[a("label",[t._v("摘要：")])]),t._v(" "),a("el-col",{attrs:{span:22}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.abstract,callback:function(e){t.abstract=e},expression:"abstract"}})],1)],1),t._v(" "),a("el-input",{attrs:{placeholder:"光秃秃去给人看，你愿意么",readonly:""}},[a("template",{slot:"prepend"},[a("el-button",{attrs:{type:"primary"},on:{click:function(e){return e.stopPropagation(),t.showSource(e)}}},[t._v("来一张封面图？")])],1)],2)],1),t._v(" "),a("mavon-editor",{attrs:{ishljs:!0,codeStyle:"xcode",scrollStyle:!0},model:{value:t.markdown,callback:function(e){t.markdown=e},expression:"markdown"}}),t._v(" "),a("div",{staticClass:"release-btn"},[a("el-button",[a("i",{staticClass:"fa fa-folder-open"}),t._v("存入草稿箱")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.sendArticle}},[a("i",{staticClass:"fa fa-send"}),t._v("发表")])],1),t._v(" "),a("div",{ref:"imgSource",staticClass:"folder-images",class:{"folder-images_move":t.moveIn}},[a("div",{staticClass:"folder-images_title"},[t._v("图片素材")]),t._v(" "),a("div",{staticClass:"folder-images_types"},[a("el-radio-group",{model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[a("el-radio",{attrs:{label:"all"}},[t._v("全部")]),t._v(" "),a("el-radio",{attrs:{label:"banner"}},[t._v("封面")])],1)],1),t._v(" "),a("div",{staticClass:"folder-images_list area-scroll"},[a("el-row",t._l(t.images_source,function(e,s){return a("el-col",{key:s,attrs:{span:24}},[a("div",{staticClass:"folder-images_items",on:{click:function(e){t.sourceSlt(s)}}},[a("i",{staticClass:"fa fa-close folder-images_items_close",on:{click:function(a){a.stopPropagation(),t.sourceDel(e)}}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.sourceIdx==s,expression:"sourceIdx == index"}],staticClass:"folder-images_item_selected"},[a("i",{staticClass:"fa fa-check-circle-o"})])])])})),t._v(" "),a("el-upload",{ref:"uploadForm",attrs:{drag:"",action:"http://upload.qiniup.com",data:t.uploadData,"before-upload":t.beforeUpload,"on-success":t.successUpload,multiple:""}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])])])],1),t._v(" "),a("div",{staticClass:"folder-images_source"},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{size:"mini",placeholder:"图片名",readonly:""}})],1),t._v(" "),a("el-col",{attrs:{span:24}},[a("el-input",{attrs:{size:"mini",placeholder:"线上地址",readonly:""}})],1)],1),t._v(" "),a("el-button",{staticClass:"folder-images_source_btn",attrs:{type:"primary",size:"small"}},[t._v("就决定是你了")])],1),t._v(" "),a("div",{staticClass:"folder-images_toggle",on:{click:function(e){return e.stopPropagation(),t.showSourceToggle(e)}}},[a("div",{class:{"angle-rotate-box":t.moveIn}},[a("i",{staticClass:"fa fa-angle-left",class:{"angle-rotate":t.moveIn}})])])])],1)},staticRenderFns:[]};var u=a("VU/8")(c,r,!1,function(t){a("L3d2")},"data-v-1f5f699c",null);e.default=u.exports}});
//# sourceMappingURL=3.cfea011afb0290059cf7.js.map